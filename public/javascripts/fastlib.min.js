/*! (c) 2014 HQHOME - fastlib - 2014-08-26 */
!function(){var a=function(a,b){return this.addEventListener(a,b),this};try{EventTarget.prototype.on=a}catch(b){Element.prototype.on=a,document.on=a,window.on=a}NodeList.prototype.on=function(a,b){var c,d=this.length;for(c=0;d>c;c++)this[c].on(a,b);return this},Node.prototype.addClass=function(a){return this.classList.add(a),this},Node.prototype.removeClass=function(a){return this.classList.remove(a),this},Node.prototype.toggleClass=function(a){return this.classList.toggle(a),this},Node.prototype.hasClass=function(a){return this.classList.contains(a)},Node.prototype.show=function(){return this.removeClass("hide"),this},Node.prototype.hide=function(){return this.addClass("hide"),this};var c=function(a){return document.querySelector(a)},d=function(a){return document.querySelectorAll(a)};c.ajax=function(a,b){var c=new XMLHttpRequest;c.open(a.method,a.url),c.onreadystatechange=function(){var a;if(4===c.readyState){try{a=JSON.parse(c.responseText)}catch(d){a=c.responseText}b&&b(c.status,a)}},c.send(a.data||null)};var e=function(){var a,b,e,f=!1,g=function(){h()},h=function(){window.on("hashchange",function(){var a=location.hash;switch(a){case"#!list":c(".search").hide(),c(".result").show(),c(".input-title").value="";break;default:c(".search").show(),c(".result").hide()}}),document.on("scroll",function(){var a=Math.max(document.documentElement.clientHeight,window.innerHeight),d=document.documentElement.scrollHeight,g=document.documentElement.scrollTop||window.scrollY;a+g>=d&&!f&&(f=!0,c(".js-more").show(),i(b,e))}),d(".js-query").on("submit",function(d){d.preventDefault();var g=c(".input-title"),h=c(".input-header"),k=g.value.trim()||h.value.trim();k&&(a=this.action,g.blur(),h.blur(),c(".btn-search p").hide(),c(".btn-search .loading").show(),c(".overlay").show(),c.ajax({method:"GET",url:a+k},function(a,d){"object"==typeof d&&(location.hash="!list",h.value=k,200===a||304===a?(c(".books ol").innerHTML=j(d),c(".notfound").hide(),b=k,e=2,setTimeout(function(){window.scrollTo(0,0),document.documentElement.scrollHeight<window.innerHeight&&(f=!0,c(".js-more").show(),i(b,e))},0)):404===a&&(c(".books ol").innerHTML="",c(".notfound").show()),c(".btn-search p").show(),c(".btn-search .loading").hide(),c(".overlay").hide(),c(".nomore").hide(),f=!1)}))}),c(".input-header").on("focus",function(){c(".form-header").addClass("focus")}),c(".input-header").on("blur",function(){c(".form-header").removeClass("focus")})},i=function(b,d){return b?void c.ajax({method:"GET",url:a+b+"?page="+d},function(a,b){if(c(".js-more").hide(),200===a||304===a){if(!b.length)return void c(".nomore").show();c(".books ol").innerHTML+=j(b),e++}f=!1}):void(f=!1)},j=function(a){var b,c,d=a.length,e="";for(b=0;d>b;b++)c=a[b],e+='<li><article class="col-xs-8"><h3 class="title">'+c.title+'</h3><p class="author">'+c.author+'</p><p class="publisher">'+c.publisher+'</p></article><aside class="col-xs-4"><p class="callno">'+c.callno+'</p><p class="doctype">'+c.doctype+"</p></aside></li>";return e};return{init:g}}();e.init()}();